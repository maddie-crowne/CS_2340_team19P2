<h1>Wrapped</h1>
<h2>Welcome, {{ user_data.display_name }}!</h2>

{% if selected_time_range == 'short_term' %}
    <h2>This is your Wrapped for the past month.</h2>
{% elif selected_time_range == 'medium_term' %}
    <h2>This is your Wrapped for the past 6 months.</h2>
{% elif selected_time_range == 'long_term' %}
    <h2>This is your Wrapped for the past year.</h2>
{% endif %}

{#<p>Email: {{ user_data.email }}</p>#}
{#<p>Spotify ID: {{ user_data.id }}</p>#}
{#<p>Country: {{ user_data.country }}</p>#}
{#<img src="{{ user_data.images.0.url }}" alt="Profile Picture"/>#}


<h3>Top Artists</h3>
<button id="play-artist-songs">Play Top Artist Songs</button>
{% for artist, preview_url in artist_songs.items %}
    <audio class="artist-audio">
        <source src="{{ preview_url }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
{% endfor %}
<ul>
    {% if top_artists %}
        {% for artist in top_artists.items|slice:":5" %}
            {% if artist.images.0.url %}
                <img src="{{ artist.images.0.url }}" alt="Artist Picture" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
            {% endif %}
            <li>{{ artist.name }}</li>
        {% endfor %}
    {% else %}
        <p>No top artists available.</p>
    {% endif %}
</ul>

<script>
    document.getElementById('play-artist-songs').addEventListener('click', function() {
        const audios = document.querySelectorAll('.artist-audio');
        let index = 0;

        function playNext() {
            if (index < audios.length) {
                audios[index].play().then(() => {
                    audios[index].onended = function() {
                        index++;
                        playNext();
                    };
                }).catch(err => {
                    console.error('Error playing audio:', err);
                    index++;
                    playNext();
                });
            }
        }

        playNext();
    });
</script>

<h3>Your Top Tracks</h3>
<button id="play-tracks">Play Top Tracks</button>
<ul id="track-list">
    {% for track in top_tracks.items|slice:":5" %}
        {% if track.album.images.0.url %}
            <img src="{{ track.album.images.0.url }}" alt="Album Cover" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
        {% endif %}
        <li>
            {{ track.name }} by
            {% if track.artists %}
                {{ track.artists.0.name }}
            {% else %}
                Unknown Artist
            {% endif %}
            <audio class="track-audio">
                <source src="{{ track.preview_url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        </li>
    {% endfor %}
</ul>

<script>
    document.getElementById('play-tracks').addEventListener('click', function() {
        const audios = document.querySelectorAll('.track-audio');
        let index = 0;
    
        function playNext() {
            if (index < audios.length) {
                audios[index].play().then(() => {
                    audios[index].onended = function() {
                        index++;
                        playNext();
                    };
                }).catch(err => {
                    console.error('Error playing audio:', err);
                    index++;
                    playNext();
                });
            }
        }
    
        playNext();
    });
</script>

<h3>Top Genres</h3>
<button id="play-genre-songs">Play Top Genre Songs</button>
{% for genre, preview_url in genre_songs.items %}
    <audio class="genre-audio">
        <source src="{{ preview_url }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
{% endfor %}
<ul>
    {% if top_genres %}
        {% for genre in top_genres %}
            <li>{{ genre }}</li>
        {% endfor %}
    {% else %}
        <p>No top genres available.</p>
    {% endif %}
</ul>

<script>
    document.getElementById('play-genre-songs').addEventListener('click', function() {
        const audios = document.querySelectorAll('.genre-audio');
        let index = 0;

        function playNext() {
            if (index < audios.length) {
                audios[index].play().then(() => {
                    audios[index].onended = function() {
                        index++;
                        playNext();
                    };
                }).catch(err => {
                    console.error('Error playing audio:', err);
                    index++;
                    playNext();
                });
            }
        }

        playNext();
    });
</script>

<h3>Average Valence of Top Tracks</h3>
<p>The average valence of your top tracks for the selected time frame is: {{ average_valence }}</p>
