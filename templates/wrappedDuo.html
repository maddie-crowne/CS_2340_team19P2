<!DOCTYPE html>
{% load i18n %}
<html data-wf-page="6738dd466ccbf2bcc1154b3c" data-wf-site="671a91359e3597b13381098d"
      lang="{% get_current_language as language_code %}">
<head>
    <meta charset="utf-8">
    <title>DuoWrapped</title>
    <meta content="DuoWrapped" property="og:title">
    <meta content="DuoWrapped" property="twitter:title">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    {% load static %}
    <link rel="stylesheet" href="{% static 'normalize-wrapped-2.css' %}">
    <link rel="stylesheet" href="{% static 'webflow-wrapped-2.css' %}">
    <link rel="stylesheet" href="{% static 'spotify-wrapped-2.webflow.css' %}">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({google: {families: ["Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic", "Varela Round:400", "Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic"]}});</script>
    <script type="text/javascript">
        /**
         * This script adds classes to the HTML document element based on the environment
         * (JavaScript support and touch capability), and includes links to favicon and Apple touch icon.
         *
         * 1. Adds a "js" class if JavaScript is supported.
         * 2. Adds a "touch" class if the device supports touch events.
         * 3. Sets favicon and Apple touch icon links in the HTML head.
         *
         * @function
         * @param {Window} o - The global `window` object.
         * @param {Document} c - The global `document` object.
         */
        !function (o, c) {
            // Get the root document element
            var n = c.documentElement,
                // Define a prefix for classes
                t = " w-mod-";

            // Add 'js' class to indicate JavaScript support
            n.className += t + "js";

            // Check if the device supports touch events (for touch devices)
            if ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) {
                // Add 'touch' class for touch-enabled devices
                n.className += t + "touch";
            }
        }(window, document);</script>
    <link href="../wrapped/static/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="../wrapped/static/images/webclip.png" rel="apple-touch-icon">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        /**
         * jQuery script for managing dropdown behavior.
         *
         * This script adds functionality to toggle a dropdown menu when clicking a button,
         * close the dropdown when clicking outside, and prevent closing the dropdown when
         * clicking inside it.
         */
        $(document).ready(function () {
            /**
             * Toggles the visibility of the dropdown when clicking the dropdown toggle button.
             *
             * This function listens for a click event on elements with the class `.w-dropdown-toggle`.
             * When clicked, it adds or removes the `open` class on the closest `.w-dropdown` element,
             * thus toggling its visibility.
             *
             * @function
             * @param {Event} event - The click event triggered when the toggle button is clicked.
             */
            $('.w-dropdown-toggle').click(function (event) {
                $(this).closest('.w-dropdown').toggleClass('open');
                event.stopPropagation();  // Prevents the click event from propagating to the document
            });

            /**
             * Closes any open dropdown when clicking anywhere outside of a dropdown.
             *
             * This function listens for click events on the document. If the click occurs outside
             * of any dropdown (i.e., the click target is not a descendant of `.w-dropdown`), it removes
             * the `open` class from all dropdowns, effectively closing them.
             *
             * @function
             * @param {Event} event - The click event triggered on the document.
             */
            $(document).click(function (event) {
                if (!$(event.target).closest('.w-dropdown').length) {
                    // If the click was outside the dropdown, close it
                    $('.w-dropdown').removeClass('open');
                }
            });

            /**
             * Prevents the dropdown from closing when clicking inside the dropdown itself.
             *
             * This function listens for click events on elements with the class `.w-dropdown`.
             * It stops the event from propagating to the document, preventing the dropdown from
             * being closed if the user clicks anywhere inside it.
             *
             * @function
             * @param {Event} event - The click event triggered inside the dropdown.
             */
            $('.w-dropdown').click(function (event) {
                event.stopPropagation();  // Prevents the event from reaching the document click handler
            });
        });
    </script>

    <!-- Custom CSS to show language dropdown and vibemeter thermometers -->
    <style>
        .w-dropdown-list {
            display: none;
        }

        .w-dropdown.open .w-dropdown-list {
            display: block;
        }

        .vibemeter-custom {
            display: flex; /* Ensures the layout cell is a flex container */
            justify-content: center; /* Centers the content horizontally */
            align-items: center; /* Centers the content vertically */
            padding: 0;
            margin: 0;
        }

        .image-15 {
            height: 450px; /* Fixed image height */
            max-width: 100%; /* Ensures the image doesn't overflow its container */
            width: auto; /* Maintain aspect ratio */
            margin-bottom: 50px;
        }
    </style>
</head>
<body class="body-9">
<div class="navbar-logo-center">
    <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease"
         role="banner" class="navbar-logo-center-container shadow-three w-nav">
        <div class="navbar-wrapper-three">
            <ul role="list" class="nav-menu-block-2 w-list-unstyled">
                <li>
                    <a href="{% url 'wrapped:contact_developers' %}" class="nav-link-2">{% trans "Contact Us" %}</a>
                </li>
                <li>
                    <a href="{% url 'wrapped:invite' %}" class="nav-link-2">{% trans "Invite" %}</a>
                </li>
                <li>
                    <div data-hover="true" data-delay="0" class="nav-dropdown-2 w-dropdown">
                        <div class="nav-dropdown-toggle-2 w-dropdown-toggle">
                            <div class="nav-dropdown-icon-2 w-icon-dropdown-toggle"></div>
                            <div class="text-block-13">{{ language_code|upper }}</div>
                        </div>
                        <nav class="w-dropdown-list">
                            <!-- Language switch form -->
                            <form action="{% url 'set_language' %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" name="language" value="en"
                                        class="nav-dropdown-link-2 w-dropdown-link">EN
                                </button>
                                <button type="submit" name="language" value="es"
                                        class="nav-dropdown-link-2 w-dropdown-link">ES
                                </button>
                                <button type="submit" name="language" value="fr"
                                        class="nav-dropdown-link-2 w-dropdown-link">FR
                                </button>
                            </form>
                        </nav>
                    </div>
                </li>
            </ul>
            <div class="text-block">
                <a href="{% url 'wrapped:select' %}" style="color: white; text-decoration: none;">[ Wrapped ]</a>
            </div>
            <section class="flex-block-2">
                <a href="{% url 'wrapped:account' %}" class="button-5 w-button">Button Text</a>
            </section>
            <div class="menu-button-2 w-nav-button"></div>
        </div>
        <div class="menu-button-2 w-nav-button"></div>
    </div>
</div>

<div class="div-block-17 slide">
    <div class="div-block-29">
        <div class="text-block-16">{{ user1_data.display_name }} &amp; {{ user2_data.display_name }}&#x27;s <br>DuoWrapped<br>
        </div>
        <div id="w-node-_7552cde6-667f-cef7-1f8b-a61d767a759e-c1154b3c" class="w-layout-layout wf-layout-layout">
            <div class="w-layout-cell cell-2">
                <img class="w-layout-blockcontainer container-7 w-container" src="{{ user1_data.images.0.url }}"
                     alt="Profile Picture"/>
            </div>
            <div class="w-layout-cell cell">
                <img class="w-layout-blockcontainer container-7 w-container" src="{{ user2_data.images.0.url }}"
                     alt="Profile Picture"/>
            </div>
        </div>
    </div>
    <div class="div-block-14">
        <div class="text-block-17">{% trans "Last 6 Months" %}</div>
    </div>
</div>

<section class="section-7 slide"
         style="background-image: url('
                 {% if compatibility < 50 %}{% static 'images/9.png' %}{% elif compatibility < 80 %}{% static 'images/10.png' %}{% else %}{% static '/images/11.png' %}{% endif %}');
                 background-size: cover; background-position: center;">
    <div id="w-node-_0c8af80b-a6eb-bb5e-a9aa-9d42b0d647a4-c1154b3c"
         class="w-layout-layout quick-stack-2 wf-layout-layout">
        <div id="w-node-de9b806c-f6dc-23ad-6473-72ea08fe5977-c1154b3c" class="w-layout-cell">
            <div class="text-block-27">{{ compatibility }}%</div>
        </div>
        {% if compatibility < 50 %}
            <div id="w-node-_322d55f6-fef0-9fb8-dbf0-74da1009d9e8-c1154b3c" class="w-layout-cell"></div>
            <div id="w-node-_717a00eb-a5fd-7270-dc70-5dbaeba6d65c-c1154b3c" class="w-layout-cell">
                <div class="text-block-28">{% trans "Compatible" %}</div>
            </div>
            <div class="text-block-29">{% trans "You two are from different planets" %}</div>
        {% elif compatibility < 80 %}
            <div id="w-node-_322d55f6-fef0-9fb8-dbf0-74da1009d9e8-c1154b3c" class="w-layout-cell"></div>
            <div id="w-node-_717a00eb-a5fd-7270-dc70-5dbaeba6d65c-c1154b3c" class="w-layout-cell">
                <div class="text-block-28">{% trans "Compatible" %}</div>
            </div>
            <div class="text-block-29">{% trans "You two might have similar tastes in music" %}</div>
        {% else %}
            <div id="w-node-_322d55f6-fef0-9fb8-dbf0-74da1009d9e8-c1154b3c" class="w-layout-cell"></div>
            <div id="w-node-_717a00eb-a5fd-7270-dc70-5dbaeba6d65c-c1154b3c" class="w-layout-cell">
                <div class="text-block-28">{% trans "Compatible" %}</div>
            </div>
            <div class="text-block-29">{% trans "You two might just be the same person" %}</div>
        {% endif %}
    </div>
</section>

<section class="section-8 slide">
    <div id="w-node-_58f02dd1-1c6c-a233-6480-1956adb4b5e9-c1154b3c"
         class="w-layout-layout quick-stack-3 wf-layout-layout">
        <div id="w-node-_4c807d97-e67f-19f8-e222-f123176c2908-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div class="div-block-18">{{ user1_data.display_name }}</div>
        </div>
        <div id="w-node-e0032d18-9ab6-d709-984c-525f7c8b5dbf-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div class="div-block-18">{{ user2_data.display_name }}</div>
        </div>

        <div id="w-node-_271a732a-b440-0c7f-16ea-76c841cae66f-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div id="w-node-f5fcd57c-1b18-4ea5-c562-cb2457096fbd-03f32f7d"
                 class="w-layout-cell cell-4 vibemeter-custom">
                <img src="{% static 'images/Spotify-Wrapped-Project-Page-Design-9.png' %}" loading="lazy" alt=""
                     class="image-15" style="height: 450px;">
            </div>
        </div>
        <div id="w-node-f5944232-16b1-2678-ecf1-fc77f4990d44-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div id="w-node-f5fcd57c-1b18-4ea5-c562-cb2457096fbd-03f32f7d"
                 class="w-layout-cell cell-4 vibemeter-custom">
                <img src="{% static 'images/Spotify-Wrapped-Project-Page-Design-10.png' %}" loading="lazy" alt=""
                     class="image-15" style="height: 450px;">
            </div>
        </div>
        <div id="w-node-_3b1001a7-52e1-5397-3b60-9da1c42143c1-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div class="div-block-18">72°F</div>
        </div>
        <div id="w-node-_1cf9a1f7-51fb-b696-97e9-04193a69eab8-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div class="div-block-18">50°F</div>
        </div>
        <div id="w-node-_0ec85793-e029-4be5-419e-8ea54d9c447c-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div class="text-block-30">{% trans "LOVELY<br>vibes" %}</div>
        </div>
        <div id="w-node-_13ccf896-ebe7-98d9-0352-5715bc6c00a7-c1154b3c" class="w-layout-cell vibemeter-custom">
            <div class="text-block-30">{% trans "COOL<br>vibes" %}</div>
        </div>
    </div>
</section>


<section class="section-4 slide">
    <div class="text-block-21" style="margin-top: 200px">{% trans "DUO" %}</div>
    <div class="text-block-21" style="margin-bottom: 200px">{% trans "PLAYLIST" %}</div>
</section>

<section class="top-tracks-display-copy slide">

    {% for song_url in interleaved_preview_urls %}
        {% if song_url %}
            <audio class="track-audio">
                <source src="{{ song_url }}" type="audio/mpeg">
                Your browser does not support the audio element.
            </audio>
        {% else %}
        {% endif %}
    {% endfor %}

    <div>
        <div class="w-layout-blockcontainer container-10 w-container">
            <div class="text-block-34-copy-copy-copy">{% trans "Duo Playlist" %}</div>
            <img src="{{ top_tracks_user1.items.0.album.images.0.url }}" loading="lazy" width="342" alt=""
                 class="image-17">
            <div class="text-block-35-copy-copy-copy">{{ top_tracks_user1.items.0.name }}</div>
        </div>
    </div>

    <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3e9-c1154b3c"
         class="w-layout-layout quick-stack-5 wf-layout-layout">
        {% for track in top_tracks_user1.items|slice:"1:3" %}
            <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3ea-c1154b3c" class="w-layout-cell">
                <div class="text-block-100-copy">#{{ forloop.counter|add:1 }}</div>
            </div>
            <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3ed-c1154b3c" class="w-layout-cell cell-6">
                <img src="{{ track.album.images.0.url }}" loading="lazy" width="94" alt="" class="image-16"></div>
            <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3ef-c1154b3c" class="w-layout-cell cell-5">
                <div class="text-block-35-copy-copy">{{ track.name }}</div>
            </div>
        {% endfor %}

        {% for track in top_tracks_user2.items|slice:":2" %}
            <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3ea-c1154b3c" class="w-layout-cell">
                <div class="text-block-100-copy">#{{ forloop.counter|add:3 }}</div>
            </div>
            <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3ed-c1154b3c" class="w-layout-cell cell-6">
                <img src="{{ track.album.images.0.url }}" loading="lazy" width="94" alt="" class="image-16">
            </div>
            <div id="w-node-_210e5b52-30a5-fb30-09f2-c01ee466c3ef-c1154b3c" class="w-layout-cell cell-5">
                <div class="text-block-35-copy-copy">{{ track.name }}</div>
            </div>
        {% endfor %}
    </div>
</section>

<script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=671a91359e3597b13381098d"
        type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script src="{% static 'webflow-wrapped.js' %}" type="text/javascript"></script>
</body>
</html>

<script>
    /**
     * Function to play and stop audio tracks based on the visibility of a specific slide.
     *
     * This function listens for visibility changes of a specified slide and starts playing the audio
     * tracks within the slide when it becomes visible, and stops all audio when the slide is not visible.
     *
     * @param {number} slideIndex - The index of the slide to observe.
     * @param {string} tracksSelector - The CSS selector to target the audio elements within the slide.
     */
    function playAudioOnSlide(slideIndex, tracksSelector) {
        const slide = document.querySelectorAll('.slide')[slideIndex]; // Get the slide at the specific index

        // Check if the slide element exists
        if (!slide) {
            console.error(`Slide at index ${slideIndex} not found.`);
            return; // Exit early if the slide doesn't exist
        }

        const audios = slide.querySelectorAll(tracksSelector); // Get the audio elements inside the slide
        console.log(audios); // Log the audio elements

        let index = 0;

        /**
         * Function to play the next audio track in the list.
         * If the current track ends, the next track will start playing automatically.
         */
        function playNext() {
            if (index < audios.length) {
                audios[index].play().then(() => {
                    audios[index].onended = function () {
                        index++;
                        playNext(); // Continue playing the next track when the current track ends
                    };
                }).catch(err => {
                    console.error('Error playing audio:', err);
                    index++;
                    playNext(); // Skip to next track if there's an error
                });
            }
        }

        /**
         * Function to stop all the audio tracks currently playing in the slide.
         */
        function stopAudio() {
            audios.forEach(audio => {
                audio.pause();
                audio.currentTime = 0; // Reset the audio to the beginning
            });
        }

        /**
         * Intersection Observer callback to start playing audio when the slide is in view and stop when out of view.
         *
         * @param {IntersectionObserverEntry[]} entries - Array of entries being observed.
         * @param {IntersectionObserver} observer - The IntersectionObserver instance.
         */
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) { // If the slide is visible
                    playNext();
                } else { // If the slide is no longer visible
                    stopAudio();
                }
            });
        }, {threshold: 0.5}); // Trigger when 50% of the slide is visible

        observer.observe(slide); // Start observing the slide
    }

    // Automatically play audio when the slide at index 4 becomes visible
    playAudioOnSlide(4, '.track-audio'); // Slide index 5 is where the top tracks are
</script>
