<!DOCTYPE html>
{% load i18n %}
<html data-wf-page="6723cad8d690591d3bfe6e2b" data-wf-site="671a91359e3597b13381098d"
      lang="{% get_current_language as language_code %}">
<head>
    <meta charset="utf-8">
    <title>{% trans "Account Details" %}</title>
    <meta content="{% trans "Account Details" %}" property="og:title">
    <meta content="{% trans "Account Details" %}" property="twitter:title">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="Webflow" name="generator">
    {% load static %}
    <link rel="stylesheet" href="{% static 'normalize-wrapped.css' %}">
    <link rel="stylesheet" href="{% static 'webflow-wrapped.css' %}">
    <link rel="stylesheet" href="{% static 'spotify-wrapped-single.webflow.css' %}">
    <link rel="stylesheet" href="{% static 'styling-wrapped.css' %}">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({google: {families: ["Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic", "Varela Round:400", "Open Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic"]}});</script>
    <script type="text/javascript">!function (o, c) {
        var n = c.documentElement, t = " w-mod-";
        n.className += t + "js", ("ontouchstart" in o || o.DocumentTouch && c instanceof DocumentTouch) && (n.className += t + "touch")
    }(window, document);</script>
    <link href="../wrapped/static/images/favicon.ico" rel="shortcut icon" type="image/x-icon">
    <link href="../wrapped/static/images/webclip.png" rel="apple-touch-icon">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            // Toggle dropdown when clicking the toggle button
            $('.w-dropdown-toggle').click(function (event) {
                $(this).closest('.w-dropdown').toggleClass('open');
                event.stopPropagation();  // Prevents the click from propagating to the document
            });

            // Close the dropdown when clicking outside
            $(document).click(function (event) {
                if (!$(event.target).closest('.w-dropdown').length) {
                    // If the click was outside the dropdown, close it
                    $('.w-dropdown').removeClass('open');
                }
            });

            // Prevent closing the dropdown when clicking inside the dropdown
            $('.w-dropdown').click(function (event) {
                event.stopPropagation();  // Prevents click inside the dropdown from closing it
            });
        });
    </script>

    <!-- Custom CSS to show language dropdown -->
    <style>
        .w-dropdown-list {
            display: none;
        }

        .w-dropdown.open .w-dropdown-list {
            display: block;
        }
    </style>
</head>

<body class="body-4">
<div class="navbar-logo-center">
    <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease"
         role="banner" class="navbar-logo-center-container shadow-three w-nav">
        <div class="navbar-wrapper-three">
            <ul role="list" class="nav-menu-block-2 w-list-unstyled">
                <li>
                    <a href="{% url 'wrapped:contact_developers' %}" class="nav-link-2">Contact Us</a>
                </li>
                <li>
                    <a href="{% url 'wrapped:invite' %}" class="nav-link-2">Invite</a>
                </li>
                <li>
                    <div data-hover="true" data-delay="0" class="nav-dropdown-2 w-dropdown">
                        <div class="nav-dropdown-toggle-2 w-dropdown-toggle">
                            <div class="nav-dropdown-icon-2 w-icon-dropdown-toggle"></div>
                            <div class="text-block-13">
                                {% get_current_language as language_code %}
                                {{ language_code|upper }}
                            </div>
                        </div>
                        <nav class="nav-dropdown-list-2 shadow-three mobile-shadow-hide w-dropdown-list">
                            <!-- Language switch form -->
                            <form action="{% url 'set_language' %}" method="POST">
                                {% csrf_token %}
                                <button type="submit" name="language" value="en"
                                        class="nav-dropdown-link-2 w-dropdown-link">EN
                                </button>
                                <button type="submit" name="language" value="es"
                                        class="nav-dropdown-link-2 w-dropdown-link">ES
                                </button>
                                <button type="submit" name="language" value="fr"
                                        class="nav-dropdown-link-2 w-dropdown-link">FR
                                </button>
                            </form>
                        </nav>
                    </div>
                </li>
            </ul>
            <div class="text-block">[ Wrapped ]</div>
            <section class="flex-block-2">
                <a href="{% url 'wrapped:account' %}" class="button-5 w-button">Button Text</a>
            </section>
            <div class="menu-button-2 w-nav-button"></div>
        </div>
        <div class="menu-button-2 w-nav-button"></div>
    </div>
</div>
<div class="div-block-6">
    <div id="w-node-_50df189a-5ae4-4a77-e837-a4879f09f99f-3bfe6e2b">
        <div class="div-block-10">
            <h1 class="heading-6"><strong class="bold-text-6">Saved Wraps</strong></h1>
            <div style="margin-left: -25px; height: 350px; overflow-y: auto;" class="div-block-4 wrap1">
                <div class="saved-individual-wraps div-block-4 wrap2">
                    <ul role="list" class="list-2 wrap wrap2">
                        {% for wrap in saved %}
                            <li class="wrapped_text_delete OMG" style="width: 90%; display: flex;">
                                <a href="{% url 'wrapped:view_saved_wrap' wrap.id %}?time_range={{ wrap.time_range }}">
                                    {% if wrap.time_range == 'short_term' %}
                                        <p style="height: 80%; width: 125%; white-space: normal; margin: 10px; padding: 10px 5px 0 5px;"
                                           class="button-2 w-button"><strong class="bold-text-13">Monthly Wrap: <span
                                                class="month-range"
                                                data-created-at="{{ wrap.created_at }}"></span></strong></p>
                                    {% elif wrap.time_range == 'medium_term' %}
                                        <p style="height: 80%; width: 125%; white-space: normal; margin: 10px; padding: 10px 5px 0 5px;"
                                           class="button-2 w-button"><strong class="bold-text-13">6 Month Wrap: <span
                                                class="month-range"
                                                data-created-at="{{ wrap.created_at }}"></span></strong></p>
                                    {% elif wrap.time_range == 'long_term' %}
                                        <p style="height: 80%; width: 125%; white-space: normal; margin: 10px; padding: 10px 5px 0 5px;"
                                           class="button-2 w-button"><strong class="bold-text-13">Yearly Wrap: <span
                                                class="month-range"
                                                data-created-at="{{ wrap.created_at }}"></span></strong></p>
                                    {% endif %}
                                </a>

                                <!-- Delete Button -->
                                <form action="{% url 'wrapped:delete_wrap' wrap.id %}" method="POST"
                                      onsubmit="return confirm('Are you sure you want to unsave this wrap?');">
                                    {% csrf_token %}
                                    <button style="margin: 10px 0 0 100px" type="submit"
                                            class="button-3 w-button delete-wrap-button">Delete
                                    </button>
                                </form>
                            </li>
                        {% empty %}
                            <li>No favorite wraps found.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="div-block-9">
            <h1 class="heading-6"><strong class="bold-text-6">Saved DuoWraps</strong></h1>
            <div style="margin-left: -25px; height: 350px; overflow-y: auto;" class="div-block-4 wrap1">
                <div class="saved-duo-wraps div-block-4 wrap2">
                    <ul role="list" class="list-2 wrap wrap2">
                        {% for wrap in duo_saved %}
                            <li class="wrapped_text_delete OMG" style="width: 90%; display: flex;">
                                <a href="{% url 'wrapped:view_saved_duo_wrap' wrap.id %}">
                                    <p style="height: 80%; width: 125%; white-space: normal; margin: 10px; padding: 10px 5px 0 5px;"
                                       class="button-2 w-button">
                                        <strong class="bold-text-13">
                                            {{ wrap.user1_data.display_name }} and {{ wrap.user2_data.display_name }}'s
                                            6 Month DuoWrap {{ wrap.created_at|date:"m/d/y" }}
                                        </strong>
                                    </p>
                                </a>

                                <!-- Delete Button -->
                                <form action="{% url 'wrapped:delete_duo_wrap' wrap.id %}" method="POST"
                                      id="delete-form-{{ wrap.id }}">
                                    {% csrf_token %}
                                    <button style="margin: 10px 0 0 100px" type="submit"
                                            class="delete-wrap-button button-3 w-button">Delete
                                    </button>
                                </form>

                                <script>
                                    document.querySelectorAll('.saved-duo-wraps form').forEach(function (form) {
                                        form.addEventListener('submit', function (e) {
                                            // Prevent default form submission for handling confirmation
                                            e.preventDefault();

                                            // Show confirmation dialog
                                            if (confirm('Are you sure you want to unsave this wrap?')) {
                                                // If confirmed, submit the form normally
                                                form.submit();
                                            } else {
                                                // If canceled, reload the page
                                                location.reload();
                                            }
                                        });
                                    });
                                </script>
                            </li>
                        {% empty %}
                            <li>No favorite wraps found.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <section id="w-node-b8e62a2e-8796-9b8e-64d4-a701900e190f-3bfe6e2b" style="width: 100%;"
             class="section-2 account_info">
        <div class="div-block-7">
            <img style="margin: 20px; border-radius: 100px;" width="178" height="178" sizes="178px" class="image-5"
                 src="{{ user_data.images.0.url }}"
                 alt="Profile Picture"/>
            <div class="text-block-6">
                <strong class="bold-text-9">Account Details</strong>
            </div>
            <button id="logout-button" onclick="window.location.href='{% url 'auth:logout' %}'"
                    class="user-log-in-log-out-2">Log out
            </button>
            <div class="w-layout-vflex flex-block-7">
                <div class="text-block-11"><strong
                        class="bold-text-10">Name: {{ user.first_name }} {{ user.last_name }} </strong></div>
                <div class="text-block-10"><strong class="bold-text-7">Email: {{ user.email }} </strong></div>
                <div class="text-block-9"><strong class="bold-text-8">Username: {{ user.username }}</strong>
                </div>
            </div>
            <form class="button-10 w-button" action="{% url 'auth:delete_account' %}" method="POST"
                  onsubmit="return confirm('Are you sure you want to delete your account?');">
                {% csrf_token %}
                <button type="submit" class="delete-account-button">Delete Account</button>
            </form>
        </div>
    </section>
</div>
<script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=671a91359e3597b13381098d"
        type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<script src="/wrapped/static/webflow-wrapped.js" type="text/javascript"></script>
<script>
    // Array of month names
    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

    // Function to parse non-standard date formats (like "Nov. 2, 2024, 2:11 p.m.")
    function parseCustomDate(dateString) {
        // Extract the date portion (e.g., "Nov. 2, 2024") and remove the time
        const datePart = dateString.split(',')[0];

        // Replace month abbreviation with full month name (if needed)
        const monthAbbr = datePart.split(' ')[0].replace('.', '');
        const monthIndex = months.findIndex(month => month.toLowerCase().startsWith(monthAbbr.toLowerCase()));

        // Extract the year
        const year = dateString.split(',')[1].trim();  // The part after the comma (e.g., "2024")

        // Formatted date string with full month name, day, and year
        const formattedDate = `${months[monthIndex]} ${datePart.split(' ')[1]}, ${year}`;
        return new Date(formattedDate);
    }

    // Function to get month range
    function getMonthRange(createdAt, timeRange) {
        const createdDate = parseCustomDate(createdAt);
        const currentMonth = createdDate.getMonth();
        const currentYear = createdDate.getFullYear();

        let startMonth, endMonth, startYear, endYear;

        if (timeRange === 'short_term') {
            // Monthly wrapped
            startMonth = (currentMonth - 1 + 12) % 12;  // 5 months before
            startYear = currentYear - (currentMonth - 1 < 0 ? 1 : 0); // Adjust year if needed
            endMonth = currentMonth;
            endYear = currentYear;
        } else if (timeRange === 'medium_term') {
            // 6 months wrapped
            startMonth = (currentMonth - 5 + 12) % 12;  // 5 months before
            startYear = currentYear - (currentMonth - 5 < 0 ? 1 : 0); // Adjust year if needed
            endMonth = currentMonth;
            endYear = currentYear;
        } else if (timeRange === 'long_term') {
            // Yearly wrapped
            startMonth = (currentMonth - 12 + 12) % 12;  // 5 months before
            startYear = currentYear - (currentMonth - 12 < 0 ? 1 : 0); // Adjust year if needed
            endMonth = currentMonth;
            endYear = currentYear;
        }

        // Format months and years for display
        const startMonthName = months[startMonth];
        const endMonthName = months[endMonth];

        return `${startMonthName} ${startYear} - ${endMonthName} ${endYear}`;
    }

    // Add the month range to each "month-range" span
    document.querySelectorAll('.month-range').forEach(function (element) {
        const createdAt = element.getAttribute('data-created-at');
        const timeRange = element.closest('li').querySelector('p').textContent.trim().toLowerCase().includes('monthly') ? 'short_term' :
            element.closest('li').querySelector('p').textContent.trim().toLowerCase().includes('6 month') ? 'medium_term' :
                'long_term';
        const monthRange = getMonthRange(createdAt, timeRange);
        element.textContent = monthRange;
    });

    document.addEventListener("DOMContentLoaded", function () {
        const savedDuoWrapsContainer = document.querySelector(".saved-duo-wraps");
        const savedDuoWrapsList = savedDuoWrapsContainer.querySelector(".list-2");

        // Function to adjust container size based on the number of items
        function adjustContainerSize() {
            const itemCount = savedDuoWrapsList.children.length;
            if (itemCount > 0) {
                savedDuoWrapsContainer.style.height = `${itemCount * 60 + 20}px`; // Adjust this to fit your design
            } else {
                savedDuoWrapsContainer.style.height = "auto"; // Shrinks when no items exist
            }
        }

        // Adjust container size when a new item is added
        document.querySelectorAll(".saved-duo-wraps form").forEach(function (form) {
            form.addEventListener("submit", function (e) {
                e.preventDefault(); // Prevents immediate submission to allow resizing
                // Remove the wrap from the DOM (simulate delete)
                form.closest("li").remove();
                adjustContainerSize(); // Adjust the size after deletion
            });
        });

        // Initial adjustment on page load
        adjustContainerSize();
    });
</script>
</body>
</html>

<style>
    .delete-wrap-button {
        position: relative;
        left: 20px;
    }
</style>

